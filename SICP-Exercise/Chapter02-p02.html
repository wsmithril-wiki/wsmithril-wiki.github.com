<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript" src="../js/html5.js"></script><![endif]-->
    <link type="image/x-icon" rel="icon" href="/favicon.ico" />
    <link type="image/x-icon" rel="shortcut icon" href="/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="/css/style.css" />
    <script type="text/javascript" src="/MathJax/MathJax.js?config=TeX-AMS-MML_SVG"></script>
    <title>Chapter02-p02</title>
</head>
<body>
    <div class="content">
    
<h1 id="toc_1">SICP Exercises</h1>
<h2 id="toc_1.1">Chapter 02 - Part.II</h2>

<h3 id="toc_1.1.1">Exercise 2.42</h3>
<p>
The "Eight-Queens Puzzle" asks how to place eight queens on a chessboard so that
no queen is in check from any other (i.e., no two queens are in the same row,
column, or diagonal). One way to solve the puzzle is to work across the board,
placing a queen in each column. Once we have placed \(k-1\) queens, we must
place the \(k\)-th queen in a position where it does not check any of the queens
already on the board. We can formulate this approach recursively: Assume that
we have already generated the sequence of all possible ways to place
\(k-1\) queens in the first \(k-1\) columns of the board. For each of these ways,
generate an extended set of positions by placing a queen in each row of the \(k\)-th
column. Now filter these, keeping only the positions for which the queen in the
\(k\)-th column is safe with respect to the other queens. This produces the sequence
of all ways to place \(k\) queens in the first \(k\) columns. By continuing this
process, we will produce not only one solution, but all solutions to the
puzzle.
</p>

<p>
We implement this solution as a procedure queens, which returns a sequence of
all solutions to the problem of placing \(n\) queens on an \(n\times n\) chessboard. Queens
has an internal procedure <code>queen-cols</code> that returns the sequence of all ways to
place queens in the first \(k\) columns of the board.
</p>

<pre class="brush: scheme">
(define (queens board-size)
  (define (queen-cols k)  
    (if (= k 0)
        (list empty-board)
        (filter
         (lambda (positions) (safe? k positions))
         (flatmap
          (lambda (rest-of-queens)
            (map (lambda (new-row)
                   (adjoin-position new-row k rest-of-queens))
                 (enumerate-interval 1 board-size)))
          (queen-cols (- k 1))))))
  (queen-cols board-size))
</pre>

<p>
In this procedure <code>rest-of-queens</code> is a way to place \(k-1\) queens in the first
\(k-1\) columns, and <code>new-row</code> is a proposed row in which to place the queen for the
\(k\)-th column. Complete the program by implementing the representation for sets of
board positions, including the procedure <code>adjoin-position</code>, which adjoins a new
<code>row-column</code> position to a set of positions, and <code>empty-board</code>, which represents an
empty set of positions. You must also write the procedure <code>safe?</code>, which
determines for a set of positions, whether the queen in the \(k\)-th column is safe
with respect to the others. (Note that we need only check whether the new queen
is safe -- the other queens are already guaranteed safe with respect to each
other.)
</p>

<ul>
<li>
Answer:

</ul>

<pre class="brush: scheme">
; an empty map has no queens
(define (empty-board) '())

; the adjoint-position returns an list of k possible columns, having the k-th quene
; in the different possition
(define (adjoin-position n k cols)
    (map (lambda (i) (append cols (list i))) 
         (enumerate 1 k)))

(define (safe? k cols)
    (define all (lambda (l) (accumulate and #t l)))
    (define any (lambda (l) (accumulate or  #f l)))
    (define (diag? k r rs)
        (define (iter col rest return)
            (if (null? rest) return
                (iter (+ col 1) (cdr rest)
                      (cons (= (abs (- k (car rest))) (abs (- r col))) return))))
        (any (iter 1 rs '())))
    (let ((last (tail cols))
          (rest (con  cols)))
    (not (and (any (map (lambda (c) (= c last)) rest))
              (diag? last k con)))))
</pre>

<h2 id="toc_1.2">Exercise 2.43</h2>
<p>
Louis Reasoner is having a terrible time doing exercise 2.42. His queens
procedure seems to work, but it runs extremely slowly. (Louis never does manage
to wait long enough for it to solve even the 6×6 case.) When Louis asks Eva Lu
Ator for help, she points out that he has interchanged the order of the nested
mappings in the <code>flatmap</code>, writing it as
</p>

<pre class="brush: scheme">
(flatmap
 (lambda (new-row)
   (map (lambda (rest-of-queens)
          (adjoin-position new-row k rest-of-queens))
        (queen-cols (- k 1))))
 (enumerate-interval 1 board-size))
</pre>

<p>
Explain why this interchange makes the program run slowly. Estimate how long it
will take Louis's program to solve the eight-queens puzzle, assuming that the
program in exercise 2.42 solves the puzzle in time \(T\). 
</p>

<ul>
<li>
Answer:

</ul>

<p>
First of all, the <code>queen</code> precedure will be running in the procedure <code>safe?</code>, so
the less times <code>safe?</code> being invoked, the less time will be used solving the
puzzle.
</p>

<p>
The former <code>flatmap</code> looks like this:
</p>
<pre class="brush: scheme">
(flatmap
  (lambda (rest-of-queens)
    (map (lambda (new-row)
           (adjoin-position new-row k rest-of-queens))
                 (enumerate-interval 1 board-size)))
  (queen-cols (- k 1)))
</pre>

<p>
For an 8x8 puzzle, this one will first emurate every 8x1 board with one quenee
on it, then append another column, try every possible combinations, filter out
unsafe ones, then append a third column... until all 8 quenes are on the board
safely. So basicaly, for a n-queens puzzle, this one will try up to 
\(\sum_{i=1}^{n} \rm{A}_n^i\) times <code>safe?</code>, where \(A_n^i=\frac{n!}{(n-i)!}\), for
\(n=8\), roughly \(109600\) times. This is not included filtered ones in each
iterations. 
</p>

<p>
As for Louis's program with an 8x8 , with the interchange of nested map, it will 
try to solve every 7x7, 6x6, ..., 1x1 problem along the way, and worse, solve
the inner 7x7 problem in a same manner, solving the 6x6, 5x5, 4x4 ..., 1x1 
problems again. 
</p>

    </div>

    <div class="copyright">
        <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/cn/"><img alt="知识共享许可协议" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/2.5/cn/88x31.png" /></a>
        <br />
        本作品由<span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">WsMithril</span>创作，采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/cn/">知识共享署名-非商业性使用-相同方式共享 2.5 中国大陆许可协议</a>进行许可。
    </div>
     
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'wsmithrilswiki'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    <footer>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </footer>


</body>
<link rel="stylesheet" type="text/css" href="/SyntaxHighlighter/styles/shThemeMidnight.css" />
<script type="text/javascript" src="/SyntaxHighlighter/scripts/shCore.js"></script>
<script type="text/javascript" src="/SyntaxHighlighter/scripts/shAutoloader.js"></script>

<script type="text/javascript">
    SyntaxHighlighter.autoloader(
      'applescript            /SyntaxHighlighter/scripts/shBrushAppleScript.js',
      'actionscript3 as3      /SyntaxHighlighter/scripts/shBrushAS3.js',
      'bash shell             /SyntaxHighlighter/scripts/shBrushBash.js',
      'coldfusion cf          /SyntaxHighlighter/scripts/shBrushColdFusion.js',
      'cpp c                  /SyntaxHighlighter/scripts/shBrushCpp.js',
      'c# c-sharp csharp      /SyntaxHighlighter/scripts/shBrushCSharp.js',
      'css                    /SyntaxHighlighter/scripts/shBrushCss.js',
      'delphi pascal          /SyntaxHighlighter/scripts/shBrushDelphi.js',
      'diff patch pas         /SyntaxHighlighter/scripts/shBrushDiff.js',
      'erl erlang             /SyntaxHighlighter/scripts/shBrushErlang.js',
      'groovy                 /SyntaxHighlighter/scripts/shBrushGroovy.js',
      'java                   /SyntaxHighlighter/scripts/shBrushJava.js',
      'jfx javafx             /SyntaxHighlighter/scripts/shBrushJavaFX.js',
      'js jscript javascript  /SyntaxHighlighter/scripts/shBrushJScript.js',
      'perl pl                /SyntaxHighlighter/scripts/shBrushPerl.js',
      'php                    /SyntaxHighlighter/scripts/shBrushPhp.js',
      'text plain             /SyntaxHighlighter/scripts/shBrushPlain.js',
      'py python              /SyntaxHighlighter/scripts/shBrushPython.js',
      'ruby rails ror rb      /SyntaxHighlighter/scripts/shBrushRuby.js',
      'sass scss              /SyntaxHighlighter/scripts/shBrushSass.js',
      'scala                  /SyntaxHighlighter/scripts/shBrushScala.js',
      'sql                    /SyntaxHighlighter/scripts/shBrushSql.js',
      'vb vbnet               /SyntaxHighlighter/scripts/shBrushVb.js',
      'xml xhtml xslt html    /SyntaxHighlighter/scripts/shBrushXml.js',
      'scheme                 /SyntaxHighlighter/scripts/shBrushScheme.js',
      'hs haskell             /SyntaxHighlighter/scripts/shBrushHaskell.js',
      'asm x86 Asm            /SyntaxHighlighter/scripts/shBrushAsm.js'
    );
    SyntaxHighlighter.defaults['toolbar']    = false;
    SyntaxHighlighter.defaults['gutter']     = true;
    SyntaxHighlighter.defaults['smart-tabs'] = true;
    SyntaxHighlighter.defaults['ruler']      = true;
    SyntaxHighlighter.defaults['tab-size']   = 4;
    SyntaxHighlighter.all();
</script>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35399239-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</html>
